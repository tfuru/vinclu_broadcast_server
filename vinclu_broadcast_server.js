/** vinclu_broadcast_server.js** 機能* 受け取ったjson を接続している全てのクライアントへブロードキャストするWebSocketサーバーです* * 参考サイト* https://www.npmjs.org/package/websocket.io* http://mawatari.jp/archives/make-a-chat-application-in-node-js-and-websocket-io* **/// port番ポートでクライアントの接続を待ち受けるvar ws = require('websocket.io');var port = 8899var server = ws.listen(port, function () {  console.log('Server running');});// クライアントからの接続イベントを処理server.on('connection', function(socket) {  // クライアントからのメッセージ受信イベントを処理  socket.on('message', function(data) {    // 実行時間を追加    var data = JSON.parse(data);    //接続クライアント数を返す    data.vinclu_cnt = server.clients.length;    data = JSON.stringify(data);            // 受信したメッセージを全てのクライアントに送信する    server.clients.forEach(function(client) {      if(client.ws.readyState != 1) return;      client.send(data);    });  });});